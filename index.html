<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title></title>
    <meta name="author" content="" />
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- link href="css/normalize.css" rel="stylesheet" / -->
    <!-- link href="css/style.css" rel="stylesheet" / -->
    <style>
      * {
        -webkit-box-sizing: border-box;
        -moz-box-sizing: border-box;
        box-sizing: border-box;
        padding: 0;
        margin: 0;
      }

      html,
      body {
        height: calc(100% - 10px);
        width: calc(100% - 4px);
      }

      .red-border {
        border: 1px solid red;
      }

      body {
        display: flex;
      }

      body > div {
        flex: 1;
        border: 1px solid green;
      }

      ul {
        list-style: none;
      }

      li {
        border: 1px solid orange;
        padding: 20px;
      }

      #col1 {
        overflow: auto;
      }

      #col2 {
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .red {
        color: orangered;
      }
      .green {
        color: palegreen;
      }

      .student-detail {
        color: blueviolet;
        padding: 10px;
        background-color: papayawhip;
        animation: slide-up 0.4s ease;
      }

      @keyframes slide-up {
        0% {
          opacity: 0;
          transform: translateY(20px);
        }
        100% {
          opacity: 1;
          transform: translateY(0);
        }
      }
    </style>
  </head>

  <body>
    <div id="col1"></div>
    <div id="col2"></div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script>
      const avg = grades =>
        grades.length === 0
          ? grades.length
          : grades.reduce((acc, item) => acc + item, 0) / grades.length;

      const students = [
        {
          id: 1000,
          first: "thomas",
          last: "Rubattel",
          grades: [4, 2, 6, 6],
          threshold: 4
        },
        {
          id: 1001,
          first: "simon",
          last: "Mckenzie",
          grades: [3.5, 4.5, 3.5],
          threshold: 4.5
        },
        {
          id: 1002,
          first: "liam",
          last: "Desmontet",
          grades: [3, 5, 5.5, 4.5],
          threshold: 4.2
        },
        {
          id: 1003,
          first: "pascaline",
          last: "Fassnacht",
          grades: [2, 2.5, 3.5],
          threshold: 4.4
        },
        {
          id: 1004,
          first: "Sigmund",
          last: "Dortman",
          grades: [4, 3, 4.5, 2.5, 3.5],
          threshold: 4.4
        },
        {
          id: 1005,
          first: "Stefany",
          last: "Norberg",
          grades: [4.5, 5, 4.5, 6, 5, 5, 6],
          threshold: 5
        }
      ];

      const aggregateGrades = students => {
        // recursion with tail-recursive
        const aggregateGradesAux = ([first, ...rest], grades) =>
          first === undefined
            ? grades
            : aggregateGradesAux(rest, grades.concat(first.grades));

        return aggregateGradesAux(students, []);
      };
      console.log("school average", avg(aggregateGrades(students)));

      const checkPassed = threshold => avg => avg >= threshold;

      const getStudent = (students, id) =>
        students.find(student => student.id === id);

      const memoize = f => {
        const memo = new Map();
        return (...args) => {
          if (memo.get(args[1])) {
            console.log("Cached : ", memo.get(args[1]));
            return memo.get(args[1]);
          } else {
            const result = f(args[0], args[1]);
            memo.set(args[1], result);
            console.log("Computed : ", result);
            return result;
          }
        };
      };
      const getStudentMemo = memoize(getStudent);

      const renderStudents = students =>
        students.map(student =>
          $(`
              <li data-student-id=${student.id}>
                <div>${student.first}</div>
                <div>${student.last}</div>
              </li>`)
        );

      const renderDetailStudent = student => {
        const passed = checkPassed(student.threshold); // partial application
        const hasPassed = passed(avg(student.grades)); // composition
        return $(`
              <div class="student-detail">
                <div>First name : ${student.first}</div>
                <div>Last name : ${student.last}</div>
                <div>GPA :  ${avg(student.grades)}</div>
                <div>Passed : <span class="${hasPassed ? "green" : "red"}">${
          hasPassed ? "&#x2714;" : "&#x2717;"
        }</span></div>
              </div>`);
      };

      const decorator = handler => e => {
        e.stopPropagation();
        handler(e);
      };

      const onClickHandler = e => {
        var element = $(e.target).closest("li");
        if (element.length) {
          var studentId = $(element).attr("data-student-id");
          $("#col2")
            .empty()
            .append(
              renderDetailStudent(getStudentMemo(students, parseInt(studentId)))
            );
        }
      };

      $(function() {
        $("<ul />")
          .on("click", decorator(onClickHandler))
          .append(renderStudents(students))
          .appendTo("#col1");
      });
    </script>
  </body>
</html>
